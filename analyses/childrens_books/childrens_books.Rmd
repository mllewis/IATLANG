---
title: Montag children's book corpus
subtitle: gender analysis
author: Molly Lewis 
date: "`r Sys.Date()`"
output: 
  html_document:
    code_folding: show
    number_sections: no
    toc: yes
---
  
******

```{r setup, include = F}

# load packages
library(knitr)
library(rmarkdown)
library(tidyverse)
library(tidytext)
library(langcog)
library(kableExtra)

opts_chunk$set(echo = T, message = F, warning = F, 
               error = F, tidy = F, cache = F)
```

### Montag corpus
```{r}
d_raw <- read_lines("100Books.txt")  %>%
  as.data.frame() %>%
  rename("text" = ".") 

book_titles <- d_raw %>%
  filter(str_detect(text, regex("^Title", ignore_case = TRUE))) %>%
  rename(title = text) %>%
  mutate(book_id = 1:n(),
         title = str_replace(title, "Title: ", "")) %>%
  select(book_id, title)

author_names <- d_raw %>%
  filter(str_detect(text, regex("^Author", ignore_case = TRUE))) %>%
  rename(author = text) %>%
  mutate(book_id = 1:n(),
         author = str_replace(author, "Author: ", "")) %>%
  select(book_id, author)

d_clean <- d_raw %>%
    mutate(book_id = cumsum(str_detect(text, regex("^Title",
                                                 ignore_case = TRUE)))) %>%
    left_join(book_titles) %>%
    left_join(author_names) %>%
    filter(!str_detect(text, regex("^Title",
                                                 ignore_case = TRUE)),
           !str_detect(text, regex("^Author",
                                                 ignore_case = TRUE)),
           text != "") %>%
    group_by(book_id) %>%
    mutate(line_number = row_number(),
           text = as.character(text)) %>%
    ungroup() %>%
    select(book_id, title, author, line_number, text)

tidy_books <- d_clean %>%
  unnest_tokens(word, text) #%>%
  #anti_join(stop_words)

#write_csv(tidy_books, "tidy_montag_corpus.csv")
```

### Glasglow norms 
(Gender + others)

Overall distribution of words in Glasglow dataset:
```{r}
norms <- read_csv("GlasgowNorms.csv") %>%
  select(word, GEND_M, contains("_M")) 
  
norms %>%
  gather("norm", "rating", -1) %>%
  ggplot(aes(x = rating, fill = norm)) +
    ggtitle("Overall distribution of words in the Glasglow corpus")+
    geom_histogram() +
    facet_wrap(~norm) +
    scale_x_continuous(name="mean rating", 
                     limits=c(1, 7),
                     breaks=1:7) +
    theme(legend.position = "none")

overall_means <- norms %>%
  gather("norm", "rating", -1) %>%
  group_by(norm) %>%
  summarize(mean_rating = mean(rating))
  
```

```{r, prop_missing}
tidy_with_norms <- tidy_books %>%
  left_join(norms)


prop_na_type <- tidy_with_norms %>%
  distinct(word, .keep_all = T) %>%
  summarize(prop_na = length(which(is.na(AROU_M)))/n()) 
  

prop_na_token <- tidy_with_norms %>%
  summarize(prop_na = length(which(is.na(AROU_M)))/n())

 #tidy_books %>%
  #distinct(word)  %>%
  # write_csv("montag_words.csv")


```

In the Montag corpus, `r round(prop_na_type$prop_na, 2)` word types are missing from the Glasgow dataset, and `r round(prop_na_token$prop_na, 2)` word tokens are missing. That's a lot! This is excluding stop words.

### Mean ratings by book

They're sorted here from most feminine to most masculine.
```{r}
norm_means <- tidy_with_norms %>%
  filter(!is.na(AROU_M)) %>%
  gather("norm", "value", -1:-5) %>%
  group_by(title, norm) %>%
  multi_boot_standard(col = "value")

norm_means_wide <- norm_means %>%
  select(norm, mean) %>%
  spread(norm, mean)  %>%
  select(title, GEND_M, everything()) %>%
  arrange(GEND_M)

kable(norm_means_wide, "html") %>%
  kable_styling() %>%
  scroll_box(width = "900px", height = "400px")
```

```{r}
norm_means %>%
  left_join(overall_means) %>%
  group_by(norm) %>%
    ggplot(aes(x = mean, fill = norm)) +
    geom_histogram() +
    facet_wrap(~norm) +
    ggtitle("mean rating by book") +
    geom_vline(aes(xintercept = mean_rating), linetype = 2) +
    scale_x_continuous(name = "mean rating", 
                     limits = c(1, 7),
                     breaks = 1:7) +
    theme(legend.position = "none")
```

SCALE LABELS: (left to right)

- Arousal: Very Unarousing, Very Arousing
- Valence: Very Negative, Neutral, Very Positive
- Dominance: You are very Controlled, You are very Dominant
- Concreteness: Very Abstract, Very Concrete
- Imageability: Very Unimageable, Very Imageable
- AoA: 0-2, 3-4, 5-6, 7-8, 9-10, 11-12, 13+
- Semantic Size: Very Small, Very Big
- Gender association: Very Feminine, Very Masculine

Suprisingly, books are overall slightly more feminine than the overall sample of words. All the other norms look relatively sensible.

### Are the properties of books correlated?

Correlation matrix (color indicates signifance at the .05 level)
```{r}
corr_mat <- cor(norm_means_wide[,-1], 
                use = "pairwise.complete.obs")

p.mat <- corrplot::cor.mtest(norm_means_wide[,-1], 
                  use = "pairwise.complete.obs")$p

cols = rev(colorRampPalette(c("red", "white", "blue"))(100))

corrplot::corrplot(corr_mat, method = "color",  col = cols,
         type = "upper", order = "original", number.cex = .7,
         addCoef.col = "black", 
         p.mat = p.mat, insig = "blank", 
         tl.col = "black", tl.srt = 90,
         diag = FALSE)
```

More masculine books have words that tend to be learned later, less familiar, more negatively valenced, and lower arousal.

A regression predicting the gender of the book with all other norms:
```{r}
lm(GEND_M ~ AOA_M+AROU_M+CNC_M+DOM_M+FAM_M + 
     IMAG_M+ SIZE_M + VAL_M, d = norm_means_wide) %>%
  summary()
```

