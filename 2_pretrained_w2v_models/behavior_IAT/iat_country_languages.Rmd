---
title: IAT top languages and countries
subtitle: 2016 gender data
author: Molly Lewis 
date: "`r Sys.Date()`"
output: 
  html_document:
    code_folding: hide
    number_sections: no
    toc: yes
---
  
******

```{r setup, include = F}
rm(list = ls())

# load packages
library(knitr)
library(rmarkdown)
library(tidyverse)
library(langcog)
library(stringr)
library(forcats)
library(broom)
library(haven)
library(countrycode)

opts_chunk$set(echo = T, message = F, warning = F, 
               error = F, tidy = F, cache = F)
```

Set params
```{r}
MIN_PARTICIPANTS_PER_COUNTRY <- 100
```

## Gender-career
From wiki: 

_From 2005 to present, the Gender-Career IAT was available on the Project Implicit demonstration website (https://implicit.harvard.edu/implicit/selectatest.html Click on “Gender-Career IAT” to try it yourself). The Gender-Career IAT includes one standard IAT (Male vs. Female; Career vs. Family), sets of explicit measures on gender roles (such as association between career with females or males, personal importance of career or family), set of demographic questions (age, gender, education level, number of children, etc.), and debriefing questions about how respondents thought about their IAT score after the task._

_From 2005 to the end of 2016, there are more than 1,645,902 session IDs created for Gender-Career IAT, and the overall completion rate is around 49.8%. There were 1,052,013 respondents who completed the standard IAT part of the task, which is 63.9% of the total respondents_

******

Read in 2016 gender IAT data. 
```{r}
d <- read_sav("data/Gender-Career IAT.public.2016.sav") %>%
  select(D_biep.Male_Career_all, sex, countryres)

countries <- rev(sort(unique(d$countryres)))[1:181]

d_clean <- d %>% 
  filter(!is.na(D_biep.Male_Career_all) & !is.na(countryres)) %>%
  mutate(countryres = as.factor(countryres)) %>%
  filter(countryres %in% countries) %>%
  rename(overall_iat_score = D_biep.Male_Career_all)  %>%
  mutate(country_name = countrycode(countryres,
                                    "iso2c",
                                    "country.name")) %>%
  mutate(country_name = replace(country_name, 
                                countryres == "UK", "UK")) 

country_ns <- count(d_clean, countryres)  %>%
  filter(n >= MIN_PARTICIPANTS_PER_COUNTRY)

d_clean_frequent <- d_clean %>%
  inner_join(country_ns)
```

There are `r nrow(country_ns)` with at least `r MIN_PARTICIPANTS_PER_COUNTRY` participants. This includes `r sum(country_ns$n)` participants.

```{r}
write_csv( d_clean_frequent %>% distinct(countryres, .keep_all = T) %>% select(country_name, countryres), "countries_with_most_data.csv")
```
