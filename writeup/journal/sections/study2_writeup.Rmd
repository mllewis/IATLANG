```{r}
library(tidyverse)
library(here)
library(ggrepel)
```

# Study 2: Gender bias and grammar

The findings in Study 1 are consistent with the possibility that people's implicit biases are in part caused by input from language (language-as-causal) and that the linguistic biases simply reflect existing biases (language-as-reflection). In Study 2, we try to distinguish
between these two possibilities by examining whether linguistic biases are associated with grammatical gender, a structural aspect of language that is clearly not caused by people's gender biases. 

Languages can indicate gender in their grammar using a variety of different strategies [@corbett1991]. One way languages grammatically indicate gender is by marking the biological sex of a person in a referential noun phrase (“el ni&ntilde;o alto” (the tall boy) versus “la ni&ntilde;a alta” (the tall girl)). Many languages also extend this strategy beyond biological sex by assinging inantimate objects a "gender" and marking that assigned gender on referring phrases ("el arbol alto" (the tall tree) versus "la casa alta" (the tall house)). 

We hypothesize that grammatical gender might influence cultural stereotypes specifically in cases when it marks biological sex when refering to people. In this cases, grammatical gender highlights the gender of the person and thereby might exaggerate the gender biases present in the language. To the extent that these are causally related to people's implicit biases, languages that mark grammatical mark gender on people may be providing their speakers with additional exposure to gender biases thereby increasing their speakers' implicit biases. In Study 2, we test this hypothesis by asking whether languages that have grammatical marking of gender on people tend to have speakers with larger implicit biases, as measured by the IAT.

### Method

We coded the 26 languages in our sample for two variables: whether or not the grammar made any morphosyntactic gender distinction ("Grammatical General Gender") and whether or not the grammar marked gender on persons specifically ("Grammatical General Gender"). We coded Grammatical General Gender by consulting the WALS typological database [Feature 32a;
@wals] where available and additional resources as necessary. A language was coded as marking General Grammatical Gender if it made a male-female distinction in the grammar. We coded Grammatical Person Gender on the basis of our translations of the 32 IAT words from Study 1b. A language was coded as marking Person Grammatical Gender if it made a gender distinction for any of the target person words. 


```{r}
# occupations scores
INFILE <- here('data/study2/occupation_gender_scores.csv')
by_lang_scores <- read_csv(INFILE)

NATIVE_SPEAKER_LANGS <- c("he", "fr", "es", "de", "da", "ms", "pl", "pt",
                          "hr", "en", "zh", "ko", "nl")

# average across sr and hr
hr_new_occ <- mean(c(filter(by_lang_scores, language_code == "hr") %>%  pull(mean_prop_overlap_occs),
         filter(by_lang_scores, language_code == "sr") %>%  pull(mean_prop_overlap_occs)))
by_lang_scores_tidy <- by_lang_scores %>%
    mutate(mean_prop_overlap_occs = case_when(language_code == "hr" ~ hr_new_occ,
                                  TRUE ~ mean_prop_overlap_occs),
           native_translator = case_when(language_code %in% NATIVE_SPEAKER_LANGS ~ "native",
                                         TRUE ~ "nonnative")) %>%
  filter(language_code != "sr") 
  
BEHAVIORAL_IAT_PATH <- here("data/study0/processed/by_language_df.csv")
iat_behavioral_es <- read_csv(BEHAVIORAL_IAT_PATH) %>%
  rename(language_code = "wiki_language_code") %>%
  select(language_code, median_country_age, 
         prop_male,log_age, es_iat_sex_age_order_explicit_resid,
         es_iat_sex_age_order_implicit_resid, per_women_stem_2012_2017, n_participants)

THEORETICAL_GRAMMAR_PATH <- here("data/study2/general_gender_by_lang.csv")
theoretical_gender <- read_csv(THEORETICAL_GRAMMAR_PATH)  %>%
  select(language_code, wikipedia_grammar_type) %>%
  mutate(wikipedia_grammar_type2 = ifelse(wikipedia_grammar_type %in%  c("none", "CN"),
                                          "No Gender", 
                                          "Gender")) 

LANG_IAT_PATH <- here("data/study1b/iat_es_lang.csv")
iat_lang_es <- read_csv(LANG_IAT_PATH)

LANG_NAME_PATH <- here("data/study0/processed/lang_name_to_wiki_iso.csv")
language_names <- read_csv(LANG_NAME_PATH) %>%
  distinct(wiki_language_code, .keep_all = T)

full_df <- full_join(by_lang_scores_tidy, iat_behavioral_es) %>%
  left_join(theoretical_gender) %>%
  left_join(iat_lang_es)  %>%
  left_join(language_names, by = c("language_code" = "wiki_language_code")) 
```

```{r, fig.pos = "!t!", fig.height = 3.5, fig.width = 4, fig.cap = "Residualized behavioral IAT gender bias as a function of the proportion of gender-netural labels for set of words referring to occupations. Range corresponds to 95% CI on linear fit."}
# implicit behavioral ~ prop neutral
ggplot(full_df, aes(x = mean_prop_overlap_occs,
                    y = es_iat_sex_age_order_implicit_resid)) +
  geom_text_repel(aes(label = language_name), size = 3) +
  geom_smooth(method = "lm", alpha = .1) +
  geom_point() +
  theme_classic() +
  ggtitle("Behavioral Gender Bias and Lexicalized Gender") +
  ylab("Behavioral IAT Gender Bias (residualized)") +
  xlab("Proportion Gender-Neutral Occupation Labels") +
  theme(legend.position = "none",
        text = element_text(size = 12),
        axis.text.y = element_text(angle = 90, hjust = 0.5, size = 12))
```
Look at native vs. non-native languages


```{r, eval = F}
  
cor.test(full_df$es_iat_sex_age_order_implicit_resid, 
         full_df$mean_prop_overlap_occs)

m_base1 <- lm(es_iat_sex_age_order_implicit_resid ~ mean_prop_overlap_occs + median_country_age,
   data = full_df)

m_base2 <- lm(es_iat_sex_age_order_implicit_resid ~ wikipedia_grammar_type2 + median_country_age,
   data = full_df)

m_additive <- lm(es_iat_sex_age_order_implicit_resid ~ mean_prop_overlap_occs + wikipedia_grammar_type2 + median_country_age,
   data = full_df) 

m_interaction <- lm(es_iat_sex_age_order_implicit_resid ~ mean_prop_overlap_occs * wikipedia_grammar_type2 + median_country_age,
   data = full_df)

anova(m_additive, m_interaction)


# explicit behavioral
cor.test(full_df$es_iat_sex_age_order_explicit_resid, 
         full_df$mean_prop_overlap_occs)

lm(es_iat_sex_age_order_explicit_resid ~ mean_prop_overlap_occs * wikipedia_grammar_type2 + median_country_age,
   data = full_df) %>%
  summary()

# wiki iat
lm(lang_es_wiki ~ mean_prop_overlap_occs * wikipedia_grammar_type2,
   data = full_df) %>%
  summary()

lm(lang_es_wiki ~wikipedia_grammar_type2 * mean_prop_overlap_occs,
   data = full_df) %>%
  summary()

lm(lang_es_sub ~ mean_prop_overlap_occs * wikipedia_grammar_type2,
   data = full_df) %>%
  summary()


```

